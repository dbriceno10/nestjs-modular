Las variables de entorno son sensibles, pueden ser requeridas o no, pueden ser un string o un number. Validemos tus variables de entorno para evitar errores u omisiones de las mismas.

Validando variables de entorno
Instala la dependencia Joi con el comando npm instal joi --save. La misma nos dar谩 las herramientas para realizar validaciones de nuestras variables de entorno.

Importa Joi en el m贸dulo de tu aplicaci贸n y a trav茅s de la propiedad validationSchema del objeto que recibe el ConfigModule crea el tipado y las validaciones de tus variables de entorno.

import { ConfigModule } from '@nestjs/config';
import * as Joi from 'joi';

import config from './config';

@Module({
  imports: [
    ConfigModule.forRoot({
      envFilePath: '.env',
      load: [config],
      isGlobal: true,
      validationSchema: Joi.object({
        API_KEY: Joi.string().required(),
        DATABASE_NAME: Joi.string().required(),
        DATABASE_PORT: Joi.number().required(),
      })
    }),
  ],
  ],
})
export class AppModule {}
Lo que hace Joi es asegurar que, en el archivo .env, existan las variables de entorno indicadas dependiendo si son obligatorias o no, adem谩s de validar el tipo para no ingresar un string donde deber铆a ir un number.

En equipos de trabajo profesional, quienes suelen desplegar las aplicaciones en los entornos es el equipo DevOpsy ellos no necesariamente saben qu茅 variables de entorno necesita tu aplicaci贸n y de qu茅 tipo son. Gracias a esta configuraci贸n, tu app emitir谩 mensajes de error claros por consola cuando alguna variable no sea correcta.

Curso Profesional de DevOps

Cuadro de c贸digo para variables de entorno
npm install --save joi

// src/app.module.ts

import * as Joi from 'joi';  // 

@Module({
  imports: [
    ConfigModule.forRoot({
      envFilePath: enviroments[process.env.NODE_ENV] || '.env',
      load: [config],
      isGlobal: true,
      validationSchema: Joi.object({ // 
        API_KEY: Joi.number().required(),
        DATABASE_NAME: Joi.string().required(),
        DATABASE_PORT: Joi.number().required(),
      }),
    }),
    ...
  ],
  ...
})
export class AppModule {}
